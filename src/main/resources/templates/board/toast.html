<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.next.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<div class="container-md my-3" layout:fragment="content">
  <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
  <div id="editor"></div>
  <button type="button" class="btn btn-primary" id="sendBtn">전송</button>
  <script>
    const reader = new FileReader();
    const Editor = toastui.Editor;
    const editor = new Editor({
      el: document.querySelector('#editor'),
      height: '500px',
      initialEditType: 'markdown',
      previewStyle: 'vertical',
      hooks: {
        addImageBlobHook(blob, callback) {  // 이미지 업로드 로직 커스텀
          reader.onloadend = () => {
            callback(reader.result, blob.name);
          };
          reader.readAsDataURL(blob);
        }
      }
    });

    document.getElementById('sendBtn').addEventListener('click', () => {
      fetch('/board/toast', {
        method: 'post',
        headers: {
          'content-type': 'application/json; charset=utf-8'
        },
        body: JSON.stringify({
          content: editor.getHTML()
        })
      })
    });
  </script>
</div>